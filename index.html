<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>MtG Manabase Builder</title>
  <script src="https://unpkg.com/javascript-lp-solver/prod/solver.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <style>
    .content {
      max-width: 800px;
      margin: auto;
    }
  </style>
  <script type="text/javascript">
    function getInt(id) {
      return parseInt(document.getElementById(id).value || 0, 10)
    }

    function getBool(id) {
      return !!document.getElementById(id).checked
    }

    function solveManabase() {
      var numberOfLands = getInt("total lands")
      var castleW = getInt("castleW")
      var castleU = getInt("castleU")
      var castleB = getInt("castleB")
      var castleR = getInt("castleR")
      var castleG = getInt("castleG")
      var w = getInt("w") - castleW
      var u = getInt("u") - castleU
      var b = getInt("b") - castleB
      var r = getInt("r") - castleR
      var g = getInt("g") - castleG
      var sumCastles = castleW + castleU + castleB + castleR + castleG
      var scoreBasics = getInt("scoreBasics")
      var scoreFabledPassage = getInt("scoreFabledPassage")
      var scoreShocks = getInt("scoreShocks")
      var scoreTemples = getInt("scoreTemples")
      var scoreTriomes = getInt("scoreTriomes")
      var scoreChecks = getInt("scoreChecks")
      var maxEachBasic = getBool("includeBasics") ? 999 : 0
      var maxFabledPassage = getBool("includeFabledPassage") ? 4 : 0
      var maxEachShock = getBool("includeShocks") ? 4 : 0
      var maxEachTemple = getBool("includeTemples") ? 4 : 0
      var maxEachTriome = getBool("includeTriomes") ? 4 : 0
      var maxEachCheck = getBool("includeChecks") ? 4 : 0

      var variables = {
        "Plains (Basic W)": {"w": 1, "opt": scoreBasics, "total lands": 1, "Plains (Basic W)": 1,
          "Basics - Fabled Passages - (Fabled Passages > 0)": 1, "Plains - (Fabled Passages > 0)": 1},
        "Island (Basic U)": {"u": 1, "opt": scoreBasics, "total lands": 1, "Island (Basic U)": 1,
          "Basics - Fabled Passages - (Fabled Passages > 0)": 1, "Islands - (Fabled Passages > 0)": 1},
        "Swamp (Basic B)": {"b": 1, "opt": scoreBasics, "total lands": 1, "Swamp (Basic B)": 1,
          "Basics - Fabled Passages - (Fabled Passages > 0)": 1, "Swamps - (Fabled Passages > 0)": 1},
        "Mountain (Basic R)": {"r": 1, "opt": scoreBasics, "total lands": 1, "Mountain (Basic R)": 1,
          "Basics - Fabled Passages - (Fabled Passages > 0)": 1, "Mountains - (Fabled Passages > 0)": 1},
        "Forest (Basic G)": {"g": 1, "opt": scoreBasics, "total lands": 1, "Forest (Basic G)": 1,
          "Basics - Fabled Passages - (Fabled Passages > 0)": 1, "Forests - (Fabled Passages > 0)": 1},

        "Fabled Passage": {"w": 1, "u": 1, "b": 1, "r": 1, "g": 1, "opt": scoreFabledPassage, "total lands": 1, "Fabled Passage": 1,
          "Basics - Fabled Passages - (Fabled Passages > 0)": -1.25,
          "Plains - (Fabled Passages > 0)": -0.25,
          "Islands - (Fabled Passages > 0)": -0.25,
          "Swamps - (Fabled Passages > 0)": -0.25,
          "Mountains - (Fabled Passages > 0)": -0.25,
          "Forests - (Fabled Passages > 0)": -0.25},

        "Hallowed Fountain (Shock WU)": {"w": 1, "u": 1, "opt": scoreShocks, "total lands": 1, "Hallowed Fountain (Shock WU)": 1},
        "Godless Shrine (Shock WB)": {"w": 1, "b": 1, "opt": scoreShocks, "total lands": 1, "Godless Shrine (Shock WB)": 1},
        "Sacred Foundry (Shock WR)": {"w": 1, "r": 1, "opt": scoreShocks, "total lands": 1, "Sacred Foundry (Shock WR)": 1},
        "Temple Garden (Shock WG)": {"w": 1, "g": 1, "opt": scoreShocks, "total lands": 1, "Temple Garden (Shock WG)": 1},
        "Watery Grave (Shock UB)": {"u": 1, "b": 1, "opt": scoreShocks, "total lands": 1, "Watery Grave (Shock UB)": 1},
        "Steam Vents (Shock UR)": {"u": 1, "r": 1, "opt": scoreShocks, "total lands": 1, "Steam Vents (Shock UR)": 1},
        "Breeding Pool (Shock UG)": {"u": 1, "g": 1, "opt": scoreShocks, "total lands": 1, "Breeding Pool (Shock UG)": 1},
        "Blood Crypt (Shock BR)": {"b": 1, "r": 1, "opt": scoreShocks, "total lands": 1, "Blood Crypt (Shock BR)": 1},
        "Overgrown Tomb (Shock BG)": {"b": 1, "g": 1, "opt": scoreShocks, "total lands": 1, "Overgrown Tomb (Shock BG)": 1},
        "Stomping Grounds (Shock RG)": {"r": 1, "g": 1, "opt": scoreShocks, "total lands": 1, "Stomping Grounds (Shock RG)": 1},

        "Temple of Enlightenment (Temple WU)": {"w": 1, "u": 1, "opt": scoreTemples, "total lands": 1, "Temple of Enlightenment (Temple WU)": 1},
        "Temple of Silence (Temple WB)": {"w": 1, "b": 1, "opt": scoreTemples, "total lands": 1, "Temple of Silence (Temple WB)": 1},
        "Temple of Triumph (Temple WR)": {"w": 1, "r": 1, "opt": scoreTemples, "total lands": 1, "Temple of Triumph (Temple WR)": 1},
        "Temple of Plenty (Temple WG)": {"w": 1, "g": 1, "opt": scoreTemples, "total lands": 1, "Temple of Plenty (Temple WG)": 1},
        "Temple of Deceit (Temple UB)": {"u": 1, "b": 1, "opt": scoreTemples, "total lands": 1, "Temple of Deceit (Temple UB)": 1},
        "Temple of Epiphany (Temple UR)": {"u": 1, "r": 1, "opt": scoreTemples, "total lands": 1, "Temple of Epiphany (Temple UR)": 1},
        "Temple of Mystery (Temple UG)": {"u": 1, "g": 1, "opt": scoreTemples, "total lands": 1, "Temple of Mystery (Temple UG)": 1},
        "Temple of Malice (Temple BR)": {"b": 1, "r": 1, "opt": scoreTemples, "total lands": 1, "Temple of Malice (Temple BR)": 1},
        "Temple of Malady (Temple BG)": {"b": 1, "g": 1, "opt": scoreTemples, "total lands": 1, "Temple of Malady (Temple BG)": 1},
        "Temple of Abandon (Temple RG)": {"r": 1, "g": 1, "opt": scoreTemples, "total lands": 1, "Temple of Abandon (Temple RG)": 1},

        "Raugrin Triome (Triome WUR)": {"w": 1, "u": 1, "r": 1, "opt": scoreTriomes, "total lands": 1, "Raugrin Triome (Triome WUR)": 1},
        "Savai Triome (Triome WBR)": {"w": 1, "b": 1, "r": 1, "opt": scoreTriomes, "total lands": 1, "Savai Triome (Triome WBR)": 1},
        "Indatha Triome (Triome WBG)": {"w": 1, "b": 1, "g": 1, "opt": scoreTriomes, "total lands": 1, "Indatha Triome (Triome WBG)": 1},
        "Zagoth Triome (Triome UBG)": {"u": 1, "b": 1, "g": 1, "opt": scoreTriomes, "total lands": 1, "Zagoth Triome (Triome UBG)": 1},
        "Ketria Triome (Triome URG)": {"u": 1, "r": 1, "g": 1, "opt": scoreTriomes, "total lands": 1, "Ketria Triome (Triome URG)": 1},

        "Glacial Fortress (Check WU)": {"w": 1, "u": 1, "opt": scoreChecks, "total lands": 1, "Glacial Fortress (Check WU)": 1},
        "Isolated Chapel (Check WB)": {"w": 1, "b": 1, "opt": scoreChecks, "total lands": 1, "Isolated Chapel (Check WB)": 1},
        "Clifftop Retreat (Check WR)": {"w": 1, "r": 1, "opt": scoreChecks, "total lands": 1, "Clifftop Retreat (Check WR)": 1},
        "Sunpetal Grove (Check WG)": {"w": 1, "g": 1, "opt": scoreChecks, "total lands": 1, "Sunpetal Grove (Check WG)": 1},
        "Drowned Catacomb (Check UB)": {"u": 1, "b": 1, "opt": scoreChecks, "total lands": 1, "Drowned Catacomb (Check UB)": 1},
        "Sulfur Falls (Check UR)": {"u": 1, "r": 1, "opt": scoreChecks, "total lands": 1, "Sulfur Falls (Check UR)": 1},
        "Hinterland Harbor (Check UG)": {"u": 1, "g": 1, "opt": scoreChecks, "total lands": 1, "Hinterland Harbor (Check UG)": 1},
        "Dragonskull Summit (Check BR)": {"b": 1, "r": 1, "opt": scoreChecks, "total lands": 1, "Dragonskull Summit (Check BR)": 1},
        "Woodland Cemetery (Check BG)": {"b": 1, "g": 1, "opt": scoreChecks, "total lands": 1, "Woodland Cemetery (Check BG)": 1},
        "Rootbound Crag (Check RG)": {"r": 1, "g": 1, "opt": scoreChecks, "total lands": 1, "Rootbound Crag (Check RG)": 1},
      }

      var ints = {}
      Object.keys(variables).forEach(function (key) {
        ints[key] = 1
      })

      var model = {
        "optimize": "opt",
        "opType": "max",
        "constraints": {
          "total lands": {"equal": numberOfLands - sumCastles},
          "w": {"min": w},
          "u": {"min": u},
          "b": {"min": b},
          "r": {"min": r},
          "g": {"min": g},

          "Plains (Basic W)": {"min": 0, "max": maxEachBasic},
          "Island (Basic U)": {"min": 0, "max": maxEachBasic},
          "Swamp (Basic B)": {"min": 0, "max": maxEachBasic},
          "Mountain (Basic R)": {"min": 0, "max": maxEachBasic},
          "Forest (Basic G)": {"min": 0, "max": maxEachBasic},

          "Fabled Passage": {"min": 0, "max": maxFabledPassage},
          // if running Fabled Passage enforce more basics than Fabled Passages
          "Basics - Fabled Passages - (Fabled Passages > 0)": {"min": 0},
          // if we want any white make sure we get a plains when running a Fabled Passage
          "Plains - (Fabled Passages > 0)": {"min": w > 0 ? 0 : -100},
          "Islands - (Fabled Passages > 0)": {"min": u > 0 ? 0 : -100},
          "Swamps - (Fabled Passages > 0)": {"min": b > 0 ? 0 : -100},
          "Mountains - (Fabled Passages > 0)": {"min": r > 0 ? 0 : -100},
          "Forests - (Fabled Passages > 0)": {"min": g > 0 ? 0 : -100},

          "Hallowed Fountain (Shock WU)": {"min": 0, "max": maxEachShock},
          "Godless Shrine (Shock WB)": {"min": 0, "max": maxEachShock},
          "Sacred Foundry (Shock WR)": {"min": 0, "max": maxEachShock},
          "Temple Garden (Shock WG)": {"min": 0, "max": maxEachShock},
          "Watery Grave (Shock UB)": {"min": 0, "max": maxEachShock},
          "Steam Vents (Shock UR)": {"min": 0, "max": maxEachShock},
          "Breeding Pool (Shock UG)": {"min": 0, "max": maxEachShock},
          "Blood Crypt (Shock BR)": {"min": 0, "max": maxEachShock},
          "Overgrown Tomb (Shock BG)": {"min": 0, "max": maxEachShock},
          "Stomping Grounds (Shock RG)": {"min": 0, "max": maxEachShock},

          "Temple of Enlightenment (Temple WU)": {"min": 0, "max": maxEachTemple},
          "Temple of Silence (Temple WB)": {"min": 0, "max": maxEachTemple},
          "Temple of Triumph (Temple WR)": {"min": 0, "max": maxEachTemple},
          "Temple of Plenty (Temple WG)": {"min": 0, "max": maxEachTemple},
          "Temple of Deceit (Temple UB)": {"min": 0, "max": maxEachTemple},
          "Temple of Epiphany (Temple UR)": {"min": 0, "max": maxEachTemple},
          "Temple of Mystery (Temple UG)": {"min": 0, "max": maxEachTemple},
          "Temple of Malice (Temple BR)": {"min": 0, "max": maxEachTemple},
          "Temple of Malady (Temple BG)": {"min": 0, "max": maxEachTemple},
          "Temple of Abandon (Temple RG)": {"min": 0, "max": maxEachTemple},

          "Raugrin Triome (Triome WUR)": {"min": 0, "max": maxEachTriome},
          "Savai Triome (Triome WBR)": {"min": 0, "max": maxEachTriome},
          "Indatha Triome (Triome WBG)": {"min": 0, "max": maxEachTriome},
          "Zagoth Triome (Triome UBG)": {"min": 0, "max": maxEachTriome},
          "Ketria Triome (Triome URG)": {"min": 0, "max": maxEachTriome},

          "Glacial Fortress (Check WU)": {"min": 0, "max": maxEachCheck},
          "Isolated Chapel (Check WB)": {"min": 0, "max": maxEachCheck},
          "Clifftop Retreat (Check WR)": {"min": 0, "max": maxEachCheck},
          "Sunpetal Grove (Check WG)": {"min": 0, "max": maxEachCheck},
          "Drowned Catacomb (Check UB)": {"min": 0, "max": maxEachCheck},
          "Sulfur Falls (Check UR)": {"min": 0, "max": maxEachCheck},
          "Hinterland Harbor (Check UG)": {"min": 0, "max": maxEachCheck},
          "Dragonskull Summit (Check BR)": {"min": 0, "max": maxEachCheck},
          "Woodland Cemetery (Check BG)": {"min": 0, "max": maxEachCheck},
          "Rootbound Crag (Check RG)": {"min": 0, "max": maxEachCheck},
        },
        "variables": variables,
        "ints": ints
      }

      var solution = solver.Solve(model)

      var output = "result manabase:\n\n"
      output += castleW === 0 ? "" : castleW + " Castle Ardenvale (Castle W)\n"
      output += castleU === 0 ? "" : castleU + " Castle Vantress (Castle U)\n"
      output += castleB === 0 ? "" : castleB + " Castle Locthwain (Castle B)\n"
      output += castleR === 0 ? "" : castleR + " Castle Embereth (Castle R)\n"
      output += castleG === 0 ? "" : castleG + " Castle Garenbrig (Castle G)\n"

      if (solution.feasible) {
        Object.keys(solution).forEach(function(prop) {
          if (Object.keys(variables).includes(prop)) {
            output += solution[prop] + " " + prop + "\n"
          }
        })
        document.getElementById("solution").innerHTML = output
      } else {
        document.getElementById("solution").innerHTML = "impossible"
        document.getElementById("actualTotalLands").innerHTML = ""
        document.getElementById("actualW").innerHTML = ""
        document.getElementById("actualU").innerHTML = ""
        document.getElementById("actualB").innerHTML = ""
        document.getElementById("actualR").innerHTML = ""
        document.getElementById("actualG").innerHTML = ""
        return
      }


      var actualTotalLands = sumCastles
      var actualW = castleW
      var actualU = castleU
      var actualB = castleB
      var actualR = castleR
      var actualG = castleG
      Object.keys(solution).forEach(function(prop) {
        if (Object.keys(variables).includes(prop)) {
          actualTotalLands += solution[prop]
          if (prop === "Fabled Passage") {
            actualW += solution["Plains (Basic W)"] > 0 ? solution[prop] : 0
            actualU += solution["Island (Basic U)"] > 0 ? solution[prop] : 0
            actualB += solution["Swamp (Basic B)"] > 0 ? solution[prop] : 0
            actualR += solution["Mountain (Basic R)"] > 0 ? solution[prop] : 0
            actualG += solution["Forest (Basic G)"] > 0 ? solution[prop] : 0
          } else {
            actualW += solution[prop] * (variables[prop]["w"] || 0)
            actualU += solution[prop] * (variables[prop]["u"] || 0)
            actualB += solution[prop] * (variables[prop]["b"] || 0)
            actualR += solution[prop] * (variables[prop]["r"] || 0)
            actualG += solution[prop] * (variables[prop]["g"] || 0)
          }
        }
      })
      document.getElementById("actualTotalLands").innerHTML = actualTotalLands
      document.getElementById("actualW").innerHTML = actualW
      document.getElementById("actualU").innerHTML = actualU
      document.getElementById("actualB").innerHTML = actualB
      document.getElementById("actualR").innerHTML = actualR
      document.getElementById("actualG").innerHTML = actualG

      document.getElementById("donate").classList.remove("d-none")
    }
  </script>
</head>
<body>
  <div class="content my-4">
    <h1>MtG Manabase Builder</h1>
    <form class="my-3" onsubmit="solveManabase(); return false">
      <div class="form-group row">
        <div class="col"></div>
        <div class="col"></div>
        <div class="col">required</div>
        <div class="col">castles</div>
        <div class="col">actual</div>
      </div>
      <div class="form-group row">
        <label class="col col-form-label" for="total lands">total lands</label>
        <img src="https://gamepedia.cursecdn.com/mtgsalvation_gamepedia/1/1a/C.svg" height="36px" class="col"/>
        <div class="col">
          <input id="total lands" type="number" class="form-control" placeholder="0" required>
        </div>
        <div class="col"></div>
        <div id="actualTotalLands" class="col"></div>
      </div>
      <div class="form-group row">
        <label class="col col-form-label" for="w">white sources</label>
        <img src="https://gamepedia.cursecdn.com/mtgsalvation_gamepedia/8/8e/W.svg" height="36px" class="col"/>
        <div class="col">
          <input id="w" type="number" class="form-control" placeholder="0">
        </div>
        <div class="col">
          <input id="castleW" type="number" class="form-control" placeholder="0">
        </div>
        <div id="actualW" class="col"></div>
      </div>
      <div class="form-group row">
        <label class="col col-form-label" for="u">blue sources</label>
        <img src="https://gamepedia.cursecdn.com/mtgsalvation_gamepedia/9/9f/U.svg" height="36px" class="col"/>
        <div class="col">
          <input id="u" type="number" class="form-control" placeholder="0">
        </div>
        <div class="col">
          <input id="castleU" type="number" class="form-control" placeholder="0">
        </div>
        <div id="actualU" class="col"></div>
      </div>
      <div class="form-group row">
        <label class="col col-form-label" for="b">black sources</label>
        <img src="https://gamepedia.cursecdn.com/mtgsalvation_gamepedia/2/2f/B.svg" height="36px" class="col"/>
        <div class="col">
          <input id="b" type="number" class="form-control" placeholder="0">
        </div>
        <div class="col">
          <input id="castleB" type="number" class="form-control" placeholder="0">
        </div>
        <div id="actualB" class="col"></div>
      </div>
      <div class="form-group row">
        <label class="col col-form-label" for="r">red sources</label>
        <img src="https://gamepedia.cursecdn.com/mtgsalvation_gamepedia/8/87/R.svg" height="36px" class="col"/>
        <div class="col">
          <input id="r" type="number" class="form-control" placeholder="0">
        </div>
        <div class="col">
          <input id="castleR" type="number" class="form-control" placeholder="0">
        </div>
        <div id="actualR" class="col"></div>
      </div>
      <div class="form-group row">
        <label class="col col-form-label" for="g">green sources</label>
        <img src="https://gamepedia.cursecdn.com/mtgsalvation_gamepedia/8/88/G.svg" height="36px" class="col"/>
        <div class="col">
          <input id="g" type="number" class="form-control" placeholder="0">
        </div>
        <div class="col">
          <input id="castleG" type="number" class="form-control" placeholder="0">
        </div>
        <div id="actualG" class="col"></div>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>

    <pre id="solution"></pre>
    <div id="donate" class="d-none">
      <a href='https://ko-fi.com/Z8Z51NG5X' target='_blank'>
        <img height='36' style='border:0px;height:36px;' src='https://cdn.ko-fi.com/cdn/kofi2.png?v=2' border='0'
          alt='Buy Me a Coffee at ko-fi.com' />
      </a>
      <form class="mt-2" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="TJ8E5ZSCKA4YG" />
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0"
          name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
        <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
      </form>
    </div>

    <form onsubmit="solveManabase(); return false" class="border border-dark p-2 col-sm-6 my-3">
      <div class="mb-3">color requirements will ALWAYS be met, further optimization takes the following scores into account</div>
      <div class="form-group row">
        <div class="col"></div>
        <div class="col">score</div>
        <div class="col">include</div>
      </div>
      <div class="form-group row">
        <label class="col">Basic Lands</label>
        <div class="col"><input id="scoreBasics" class="form-control" type="number" value="102"></div>
        <div class="col"><input id="includeBasics" class="form-control" type="checkbox" checked></div>
      </div>
      <div class="form-group row">
        <label class="col">Fabled Passage</label>
        <div class="col"><input id="scoreFabledPassage" class="form-control" type="number" value="90"></div>
        <div class="col"><input id="includeFabledPassage" class="form-control" type="checkbox" checked></div>
      </div>
      <div class="form-group row">
        <label class="col">Shocklands</label>
        <div class="col"><input id="scoreShocks" class="form-control" type="number" value="100"></div>
        <div class="col"><input id="includeShocks" class="form-control" type="checkbox" checked></div>
      </div>
      <div class="form-group row">
        <label class="col">Temples</label>
        <div class="col"><input id="scoreTemples" class="form-control" type="number" value="1"></div>
        <div class="col"><input id="includeTemples" class="form-control" type="checkbox" checked></div>
      </div>
      <div class="form-group row">
        <label class="col">Triomes</label>
        <div class="col"><input id="scoreTriomes" class="form-control" type="number" value="-1"></div>
        <div class="col"><input id="includeTriomes" class="form-control" type="checkbox" checked></div>
      </div>
      <div class="form-group row">
        <label class="col">Checklands</label>
        <div class="col"><input id="scoreChecks" class="form-control" type="number" value="101"></div>
        <div class="col"><input id="includeChecks" class="form-control" type="checkbox" unchecked></div>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>

    <h2>FAQ</h2>
    <h4 class="mt-2">How many lands should I play?</h4>
    Check out Frank Karsten's <a href="https://www.channelfireball.com/all-strategy/articles/how-many-lands-do-you-need-to-consistently-hit-your-land-drops/">awesome article</a>.

    <h4 class="mt-2">How many sources of each color should I play?</h4>
    Check out Frank Karsten's <a href="https://www.channelfireball.com/all-strategy/articles/how-many-colored-mana-sources-do-you-need-to-consistently-cast-your-spells-a-guilds-of-ravnica-update/">other awesome article</a>.

    <h4 class="mt-2">How does this work?</h4>
    Manabase building can be modeled as a <a href="https://en.wikipedia.org/wiki/Linear_programming#Integer_unknowns">linear program with integer variables</a>, where all color requirements must be met while maximizing the number of untapped sources. There are solvers for these type of problems, like the <a href="https://github.com/JWally/jsLPSolver">amazing jsLPSolver</a>, which I used here.
  </div>
</body>
</html>